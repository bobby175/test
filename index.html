<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Online</title>

<link rel="manifest" href="manifest.json">

<style>
html,body{
  margin:0;height:100%;
  background:#0f0f14;
  font-family:system-ui,Segoe UI,Arial;
  color:#fff;
  overflow-x:hidden;
  touch-action:pan-y;
}
.container{
  max-width:700px;height:100%;
  margin:auto;
  display:flex;flex-direction:column;
  padding:12px;
}
h1{text-align:center;color:#00e0ff;margin:6px 0}
#userName{
  padding:8px;border-radius:8px;
  border:none;margin-bottom:6px;
}
#userName:disabled{opacity:.6;background:#1a1a22}
.chat{
  flex:1;overflow-y:auto;
  display:flex;flex-direction:column;
  gap:8px;padding:6px 4px;
}
.bubble{
  max-width:78%;
  padding:8px 10px;
  border-radius:8px;
  font-size:14px;
  word-wrap:break-word;
}
.left{align-self:flex-start;border-top-left-radius:0}
.right{align-self:flex-end;background:#075e54;border-top-right-radius:0}
.meta{font-size:12px;font-weight:600}
.name{filter:brightness(1.3)}
textarea{
  min-height:60px;border-radius:20px;
  border:none;padding:10px;
  background:#1c1c25;color:#fff;
}
button{
  margin-top:6px;padding:12px;
  border:none;border-radius:20px;
  background:#25d366;font-weight:600;
}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ’¬ Chat Online</h1>
  <input id="userName" placeholder="Nama kamu">
  <div class="chat" id="chat"></div>
  <textarea id="input" placeholder="Tulis pesan..."></textarea>
  <button id="sendBtn">Kirim</button>
  <div style="text-align:center;font-size:11px;opacity:.5;margin-top:6px">dibuat oleh A.M.</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PASTE_API_KEY",
  authDomain: "note-ad793.firebaseapp.com",
  projectId: "note-ad793",
  storageBucket: "note-ad793.appspot.com",
  messagingSenderId: "932514166408",
  appId: "1:932514166408:web:bba048952443b58f14113d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const nameInput = document.getElementById("userName");

let lastId = null;

onSnapshot(collection(db,"notes"), snap=>{
  snap.docChanges().forEach(ch=>{
    if(ch.type==="added"){
      const d = ch.doc.data();
      if(lastId && ch.doc.id!==lastId && Notification.permission==="granted"){
        new Notification(d.name||"Pesan baru",{body:d.text||""});
      }
      lastId = ch.doc.id;

      const div = document.createElement("div");
      div.className="bubble left";
      div.innerHTML=`<div class="meta"><span class="name">${d.name}</span></div><div>${d.text}</div>`;
      chat.appendChild(div);
    }
  });
  chat.scrollTop = chat.scrollHeight;
});

document.getElementById("sendBtn").onclick = async ()=>{
  if(!nameInput.value||!input.value) return;
  await addDoc(collection(db,"notes"),{
    name:nameInput.value,
    text:input.value,
    createdAt:serverTimestamp()
  });
  input.value="";
};

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
if("Notification" in window && Notification.permission!=="granted"){
  Notification.requestPermission();
}
</script>
</body>
</html>
